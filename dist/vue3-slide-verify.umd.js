(function(t,g){typeof exports=="object"&&typeof module!="undefined"?module.exports=g(require("vue")):typeof define=="function"&&define.amd?define(["vue"],g):(t=typeof globalThis!="undefined"?globalThis:t||self,t.vue3SlideVerify=g(t.Vue))})(this,function(t){"use strict";const g=Math.PI;function I(e,n){return e+n}function L(e){return e*e}function F(e,n,s,o,r,a){e.beginPath(),e.moveTo(n,s),e.arc(n+o/2,s-r+2,r,.72*g,2.26*g),e.lineTo(n+o,s),e.arc(n+o+r-2,s+o/2,r,1.21*g,2.78*g),e.lineTo(n+o,s+o),e.lineTo(n,s+o),e.arc(n+r-2,s+o/2,r+.4,2.76*g,1.24*g,!0),e.lineTo(n,s),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e[a](),e.globalCompositeOperation="destination-over"}function R(e,n){const s=document.createElement("img");return s.crossOrigin="Anonymous",s.onload=n,s.onerror=()=>{s.src=V(e)},s.src=V(e),s}function T(e,n){return Math.round(Math.random()*(n-e)+e)}function V(e){const n=e.length;return n>0?e[T(0,n-1)]:"https://picsum.photos/300/150?image="+T(0,1084)}function Y(e,n,s={leading:!0,trailing:!0}){const{leading:o,trailing:r,resultCallback:a}=s;let l=0,p=null;const E=function(...i){return new Promise((v,m)=>{const c=new Date().getTime();!l&&!o&&(l=c);const u=n-(c-l);if(u<=0){p&&(clearTimeout(p),p=null);const f=e.apply(this,i);a&&a(f),v(f),l=c;return}r&&!p&&(p=setTimeout(()=>{p=null,l=o?new Date().getTime():0;const f=e.apply(this,i);a&&a(f),v(f)},u))})};return E.cancel=function(){p&&clearTimeout(p),p=null,l=0},E}function q(){const e=t.reactive({x:0,y:0}),n=t.ref(!1),s=t.ref(!1),o=t.ref(0),r=t.ref([]);return{origin:e,success:n,isMouseDown:s,timestamp:o,trail:r,start:i=>{n.value||(i instanceof MouseEvent?(e.x=i.clientX,e.y=i.clientY):(e.x=i.changedTouches[0].pageX,e.y=i.changedTouches[0].pageY),s.value=!0,o.value=Date.now())},move:(i,v,m)=>{if(!s.value)return!1;let c=0,u=0;if(v instanceof MouseEvent?(c=v.clientX-e.x,u=v.clientY-e.y):(c=v.changedTouches[0].pageX-e.x,u=v.changedTouches[0].pageY-e.y),c<0||c+38>=i)return!1;m(c),r.value.push(u)},end:(i,v)=>{if(!s.value||(s.value=!1,(i instanceof MouseEvent?i.clientX:i.changedTouches[0].pageX)===e.x))return!1;o.value=Date.now()-o.value,v(o.value)},verify:(i,v,m)=>{const c=r.value,u=c.reduce(I)/c.length,f=c.map(b=>b-u),w=Math.sqrt(f.map(L).reduce(I)/c.length),C=parseInt(i);return m=m<=1?1:m>10?10:m,{spliced:Math.abs(C-v)<=m,TuringTest:u!==w}}}}var te="",P=(e,n)=>{const s=e.__vccOpts||e;for(const[o,r]of n)s[o]=r;return s};const O=t.defineComponent({name:"SlideVerify",props:{l:{type:Number,default:42},r:{type:Number,default:10},w:{type:Number,default:310},h:{type:Number,default:155},sliderText:{type:String,default:"Slide filled right"},accuracy:{type:Number,default:5},show:{type:Boolean,default:!0},imgs:{type:Array,default:()=>[]},interval:{type:Number,default:50},offset:{type:Number,default:0}},emits:["success","again","fail","refresh"],setup(e,{emit:n}){const{imgs:s,l:o,r,w:a,h:l,accuracy:p,interval:E,offset:i}=e,v=t.ref(!0),m=t.ref(0),c=t.ref(0),u=t.reactive({containerActive:!1,containerSuccess:!1,containerFail:!1}),f=t.reactive({iconCls:"arrow-right",width:"0",left:"0"}),w=t.ref(),C=t.ref(),b=t.ref(),X=t.ref();let k;const{success:M,start:A,move:J,end:K,verify:Q}=q(),$=()=>{var d,h;M.value=!1,u.containerActive=!1,u.containerSuccess=!1,u.containerFail=!1,f.iconCls="arrow-right",f.left="0",f.width="0",w.value.style.left="0",(d=X.value)==null||d.clearRect(0,0,a,l),(h=C.value)==null||h.clearRect(0,0,a,l),w.value.width=a,k.src=V(s)},Z=()=>{$(),n("refresh")};function _(d){f.left=d+"px";let h=(a-40-20)/(a-40)*d;w.value.style.left=h+"px",u.containerActive=!0,f.width=d+"px"}function x(d){const h=w.value.style.left,{spliced:S,TuringTest:N}=Q(h,m.value,p);if(S){if(p===-1){u.containerSuccess=!0,f.iconCls="success",M.value=!0,n("success",{timestamp:d,left:parseFloat(h)});return}N?(u.containerSuccess=!0,f.iconCls="success",M.value=!0,n("success",{timestamp:d,left:parseFloat(h)})):(u.containerFail=!0,f.iconCls="fail",n("again"))}else u.containerFail=!0,f.iconCls="fail",n("fail"),setTimeout(()=>{$()},1e3)}const B=Y(d=>{J(a,d,_)},E),D=d=>{K(d,x)};return t.onMounted(()=>{var S,N;const d=(S=b.value)==null?void 0:S.getContext("2d"),h=(N=w.value)==null?void 0:N.getContext("2d",{willReadFrequently:!0});X.value=d,C.value=h,k=R(s,()=>{v.value=!1;const y=o+r*2+3;if(i>0)if(i>=y+10&&i<=a-(y+10))m.value=i;else throw new Error(`offset must be greater than ${y+10} and less than ${a-(y+10)}`);else m.value=T(y+10,a-(y+10));if(c.value=T(10+r*2,l-(y+10)),d&&h){F(d,m.value,c.value,o,r,"fill"),F(h,m.value,c.value,o,r,"clip"),d.drawImage(k,0,0,a,l),h.drawImage(k,0,0,a,l);const z=c.value-r*2-1,ee=h.getImageData(m.value,z,y,y);w.value.width=y,h.putImageData(ee,0,z)}}),document.addEventListener("mousemove",B),document.addEventListener("mouseup",D)}),t.onBeforeUnmount(()=>{document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",D)}),{block:w,canvas:b,loadBlock:v,containerCls:u,sliderBox:f,refresh:Z,sliderDown:A,touchStartEvent:A,touchMoveEvent:B,touchEndEvent:D}}}),j=["width","height"],U=["width","height"],W={class:"slide-verify-slider-text"};function G(e,n,s,o,r,a){return t.openBlock(),t.createElementBlock("div",{id:"slideVerify",class:"slide-verify",style:t.normalizeStyle({width:e.w+"px"}),onselectstart:"return false;"},[t.createElementVNode("div",{class:t.normalizeClass({"slider-verify-loading":e.loadBlock})},null,2),t.createElementVNode("canvas",{ref:"canvas",width:e.w,height:e.h},null,8,j),e.show?(t.openBlock(),t.createElementBlock("div",{key:0,class:"slide-verify-refresh-icon",onClick:n[0]||(n[0]=(...l)=>e.refresh&&e.refresh(...l))},n[5]||(n[5]=[t.createElementVNode("i",{class:"iconfont icon-refresh"},null,-1)]))):t.createCommentVNode("",!0),t.createElementVNode("canvas",{ref:"block",width:e.w,height:e.h,class:"slide-verify-block"},null,8,U),t.createElementVNode("div",{class:t.normalizeClass(["slide-verify-slider",{"container-active":e.containerCls.containerActive,"container-success":e.containerCls.containerSuccess,"container-fail":e.containerCls.containerFail}])},[t.createElementVNode("div",{class:"slide-verify-slider-mask",style:t.normalizeStyle({width:e.sliderBox.width})},[t.createElementVNode("div",{class:"slide-verify-slider-mask-item",style:t.normalizeStyle({left:e.sliderBox.left}),onMousedown:n[1]||(n[1]=(...l)=>e.sliderDown&&e.sliderDown(...l)),onTouchstart:n[2]||(n[2]=(...l)=>e.touchStartEvent&&e.touchStartEvent(...l)),onTouchmove:n[3]||(n[3]=(...l)=>e.touchMoveEvent&&e.touchMoveEvent(...l)),onTouchend:n[4]||(n[4]=(...l)=>e.touchEndEvent&&e.touchEndEvent(...l))},[t.createElementVNode("i",{class:t.normalizeClass(["slide-verify-slider-mask-item-icon","iconfont",`icon-${e.sliderBox.iconCls}`])},null,2)],36)],4),t.createElementVNode("span",W,t.toDisplayString(e.sliderText),1)],2)],4)}var H=P(O,[["render",G],["__scopeId","data-v-617ae856"]]);return H});
